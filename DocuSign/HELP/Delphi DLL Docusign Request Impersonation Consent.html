<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!-- saved from url=(0081)https://www.example-code.com/delphiDll/docusign_request_impersonation_consent.asp -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Delphi DLL Docusign Request Impersonation Consent</title>

<link href="./Delphi DLL Docusign Request Impersonation Consent_files/detail.css" rel="stylesheet" type="text/css">
<link href="./Delphi DLL Docusign Request Impersonation Consent_files/download.css" rel="stylesheet" type="text/css">
<link href="./Delphi DLL Docusign Request Impersonation Consent_files/table.css" rel="stylesheet" type="text/css">
</head>

<body bgcolor="#FFFFFF">

<table width="100%" cellspacing="0" cellpadding="0" background="./Delphi DLL Docusign Request Impersonation Consent_files/bg.GIF">
  <tbody><tr> 
    <td><a href="https://www.example-code.com/delphiDll/default.asp"><img src="./Delphi DLL Docusign Request Impersonation Consent_files/banner.GIF" width="540" height="66" border="0" alt="Chilkat Examples"></a></td>
  </tr>
</tbody></table>

<p><font size="2">
<a href="https://www.chilkatsoft.com/">Chilkat</a> • 
<a href="https://www.example-code.com/">HOME</a> • <a href="https://www.example-code.com/dotnet-core/default.asp">.NET Core C#</a>
 • <a href="https://www.example-code.com/android/default.asp">Android™</a>
 • <a href="https://www.example-code.com/autoit/default.asp">AutoIt</a>
 • <a href="https://www.example-code.com/C/default.asp">C</a>
 • <a href="https://www.example-code.com/csharp/default.asp">C#</a>
 • <a href="https://www.example-code.com/cpp/default.asp">C++</a>
 • <a href="https://www.example-code.com/chilkat2-python/default.asp">Chilkat2-Python</a>
 • <a href="https://www.example-code.com/python/default.asp">CkPython</a>
 • <a href="https://www.example-code.com/asp/default.asp">Classic ASP</a>
 • <a href="https://www.example-code.com/dataflex/default.asp">DataFlex</a>
 • <a href="https://www.example-code.com/delphiAx/default.asp">Delphi ActiveX</a>
 • <a href="https://www.example-code.com/delphiDll/default.asp">Delphi DLL</a>
 • <a href="https://www.example-code.com/golang/default.asp">Go</a>
 • <a href="https://www.example-code.com/java/default.asp">Java</a>
 • <a href="https://www.example-code.com/lianja/default.asp">Lianja</a>
 • <a href="https://www.example-code.com/mono/default.asp">Mono C#</a>
 • <a href="https://www.example-code.com/nodejs/default.asp">Node.js</a>
 • <a href="https://www.example-code.com/objc/default.asp">Objective-C</a>
 • <a href="https://www.example-code.com/phpAx/default.asp">PHP ActiveX</a>
 • <a href="https://www.example-code.com/phpExt/default.asp">PHP Extension</a>
 • <a href="https://www.example-code.com/perl/default.asp">Perl</a>
 • <a href="https://www.example-code.com/powerbuilder/default.asp">PowerBuilder</a>
 • <a href="https://www.example-code.com/powershell/default.asp">PowerShell</a>
 • <a href="https://www.example-code.com/purebasic/default.asp">PureBasic</a>
 • <a href="https://www.example-code.com/ruby/default.asp">Ruby</a>
 • <a href="https://www.example-code.com/sql/default.asp">SQL Server</a>
 • <a href="https://www.example-code.com/swift/default.asp">Swift 2</a>
 • <a href="https://www.example-code.com/swift3/default.asp">Swift 3,4,5...</a>
 • <a href="https://www.example-code.com/tcl/default.asp">Tcl</a>
 • <a href="https://www.example-code.com/unicodeC/default.asp">Unicode C</a>
 • <a href="https://www.example-code.com/unicodeCpp/default.asp">Unicode C++</a>
 • <a href="https://www.example-code.com/vbnet/default.asp">VB.NET</a>
 • <a href="https://www.example-code.com/vbscript/default.asp">VBScript</a>
 • <a href="https://www.example-code.com/vb6/default.asp">Visual Basic 6.0</a>
 • <a href="https://www.example-code.com/foxpro/default.asp">Visual FoxPro</a>
 • <a href="https://www.example-code.com/xojo/default.asp">Xojo Plugin</a>

</font>
</p>
 
<table width="100%" cellspacing="0" cellpadding="3">
  <tbody><tr> 
    <td width="160" valign="top">      
<table width="320" border="1" cellspacing="0" cellpadding="5" bgcolor="#FFFFFF" bordercolor="#7F2AB2" align="left">
  <tbody><tr valign="top" bgcolor="#7F2AB2"> 
    <td colspan="2"> 
      <div align="center"><font size="2" color="#FFFFFF"><b>Delphi DLL Web API Examples</b></font></div>
          </td>
        </tr>
  <tr valign="top"> 
    <td> 
<p><font color="#333333" size="2"><b> 
<a href="https://www.example-code.com/delphiDll/default.asp">Primary Categories</a><br><br>
<a href="https://www.example-code.com/delphiDll/abn_amro.asp">ABN AMRO</a><br>
<a href="https://www.example-code.com/delphiDll/awsSecretsManager.asp">AWS Secrets Manager</a><br>
<a href="https://www.example-code.com/delphiDll/aws_sts.asp">AWS Security Token Service</a><br>
<a href="https://www.example-code.com/delphiDll/aws_translate.asp">AWS Translate</a><br>
<a href="https://www.example-code.com/delphiDll/activix.asp">Activix CRM</a><br>
<a href="https://www.example-code.com/delphiDll/adyen.asp">Adyen</a><br>
<a href="https://www.example-code.com/delphiDll/aliyun_oss.asp">Alibaba Cloud OSS</a><br>
<a href="https://www.example-code.com/delphiDll/cognito.asp">Amazon Cognito</a><br>
<a href="https://www.example-code.com/delphiDll/dynamodb.asp">Amazon DynamoDB</a><br>
<a href="https://www.example-code.com/delphiDll/mws.asp">Amazon MWS</a><br>
<a href="https://www.example-code.com/delphiDll/amazon_pay.asp">Amazon Pay</a><br>
<a href="https://www.example-code.com/delphiDll/rekognition.asp">Amazon Rekognition</a><br>
<a href="https://www.example-code.com/delphiDll/sp_api.asp">Amazon SP-API</a><br>
<a href="https://www.example-code.com/delphiDll/voiceId.asp">Amazon Voice ID</a><br>
<a href="https://www.example-code.com/delphiDll/aruba_fatturazione.asp">Aruba Fatturazione</a><br>
<a href="https://www.example-code.com/delphiDll/azure_maps.asp">Azure Maps</a><br>
<a href="https://www.example-code.com/delphiDll/azure_monitor.asp">Azure Monitor</a><br>
<a href="https://www.example-code.com/delphiDll/azure_oauth2.asp">Azure OAuth2</a><br>
<a href="https://www.example-code.com/delphiDll/azure_storage_accounts.asp">Azure Storage Accounts</a><br>
<a href="https://www.example-code.com/delphiDll/backblaze_s3.asp">Backblaze S3</a><br>
<a href="https://www.example-code.com/delphiDll/banco_inter.asp">Banco Inter</a><br>
<a href="https://www.example-code.com/delphiDll/bitfinex_v2_rest.asp">Bitfinex v2 REST</a><br>
<a href="https://www.example-code.com/delphiDll/bluzone.asp">Bluzone</a><br>
<a href="https://www.example-code.com/delphiDll/bricklink.asp">BrickLink</a><br>
<a href="https://www.example-code.com/delphiDll/bunny.asp">Bunny CDN</a><br>
<a href="https://www.example-code.com/delphiDll/callrail.asp">CallRail</a><br>
<a href="https://www.example-code.com/delphiDll/cardConnect.asp">CardConnect</a><br>
<a href="https://www.example-code.com/delphiDll/cerved.asp">Cerved</a><br>
<a href="https://www.example-code.com/delphiDll/clickBank.asp">ClickBank</a><br>
<a href="https://www.example-code.com/delphiDll/clickatell.asp">Clickatell</a><br>
<a href="https://www.example-code.com/delphiDll/cloudfare.asp">Cloudfare</a><br>
<a href="https://www.example-code.com/delphiDll/constantcontact.asp">Constant Contact</a><br>
<a href="https://www.example-code.com/delphiDll/docusign.asp">DocuSign</a><br>
<a href="https://www.example-code.com/delphiDll/duo.asp">Duo Auth MFA</a><br>
<a href="https://www.example-code.com/delphiDll/etrade.asp">ETrade</a><br>
<a href="https://www.example-code.com/delphiDll/ecwid.asp">Ecwid</a><br>
<a href="https://www.example-code.com/delphiDll/itida.asp">Egypt ITIDA</a><br>
<a href="https://www.example-code.com/delphiDll/egypt_ereceipt.asp">Egypt eReceipt</a><br>
<a href="https://www.example-code.com/delphiDll/etsy.asp">Etsy</a><br>
<a href="https://www.example-code.com/delphiDll/facebook.asp">Facebook</a><br>
<a href="https://www.example-code.com/delphiDll/faire.asp">Faire</a><br>
<a href="https://www.example-code.com/delphiDll/frame_io.asp">Frame.io</a><br>
<a href="https://www.example-code.com/delphiDll/geoop.asp">GeoOp</a><br>
<a href="https://www.example-code.com/delphiDll/getHarvest.asp">GetHarvest</a><br>
<a href="https://www.example-code.com/delphiDll/globalpayments.asp">Global Payments</a><br>
<a href="https://www.example-code.com/delphiDll/google_people_api.asp">Google People</a><br>
<a href="https://www.example-code.com/delphiDll/googleSearchConsole.asp">Google Search Console</a><br>
<a href="https://www.example-code.com/delphiDll/googleTranslate.asp">Google Translate</a><br>
<a href="https://www.example-code.com/delphiDll/nav_invoice.asp">Hungary NAV Invoicing</a><br>
<a href="https://www.example-code.com/delphiDll/ibm_text_to_speech.asp">IBM Text to Speech</a><br>
<a href="https://www.example-code.com/delphiDll/ibanity.asp">Ibanity</a><br>
<a href="https://www.example-code.com/delphiDll/intakeq.asp">IntakeQ</a><br>
<a href="https://www.example-code.com/delphiDll/jira.asp">Jira</a><br>
<a href="https://www.example-code.com/delphiDll/lightspeed.asp">Lightspeed</a><br>
<a href="https://www.example-code.com/delphiDll/myob.asp">MYOB</a><br>
<a href="https://www.example-code.com/delphiDll/magento.asp">Magento</a><br>
<a href="https://www.example-code.com/delphiDll/mailgun.asp">Mailgun</a><br>
<a href="https://www.example-code.com/delphiDll/mastercard.asp">Mastercard</a><br>
<a href="https://www.example-code.com/delphiDll/medTunnel.asp">MedTunnel</a><br>
</b></font></p></td><td><p><font color="#333333" size="2"><b><a href="https://www.example-code.com/delphiDll/mercadolibre.asp">MercadoLibre</a><br>
<a href="https://www.example-code.com/delphiDll/messagemedia.asp">MessageMedia</a><br>
<a href="https://www.example-code.com/delphiDll/msGraphCalendar.asp">Microsoft Calendar</a><br>
<a href="https://www.example-code.com/delphiDll/msGraphGroup.asp">Microsoft Group</a><br>
<a href="https://www.example-code.com/delphiDll/msGraphTaskPlans.asp">Microsoft Tasks and Plans</a><br>
<a href="https://www.example-code.com/delphiDll/teams.asp">Microsoft Teams</a><br>
<a href="https://www.example-code.com/delphiDll/moodys.asp">Moody's</a><br>
<a href="https://www.example-code.com/delphiDll/okta_oauth_oidc.asp">Okta OAuth/OIDC</a><br>
<a href="https://www.example-code.com/delphiDll/onelogin_oidc.asp">OneLogin OIDC</a><br>
<a href="https://www.example-code.com/delphiDll/onenote.asp">OneNote</a><br>
<a href="https://www.example-code.com/delphiDll/openai.asp">OpenAI ChatGPT</a><br>
<a href="https://www.example-code.com/delphiDll/PRODA.asp">PRODA</a><br>
<a href="https://www.example-code.com/delphiDll/paypal.asp">PayPal</a><br>
<a href="https://www.example-code.com/delphiDll/paynow.asp">Paynow.pl</a><br>
<a href="https://www.example-code.com/delphiDll/peoplevox.asp">Peoplevox</a><br>
<a href="https://www.example-code.com/delphiDll/populi.asp">Populi</a><br>
<a href="https://www.example-code.com/delphiDll/quickbooks.asp">QuickBooks</a><br>
<a href="https://www.example-code.com/delphiDll/rabobank.asp">Rabobank</a><br>
<a href="https://www.example-code.com/delphiDll/refinitiv.asp">Refinitiv</a><br>
<a href="https://www.example-code.com/delphiDll/royalMail.asp">Royal Mail OBA</a><br>
<a href="https://www.example-code.com/delphiDll/scis.asp">SCiS Schools Catalogue</a><br>
<a href="https://www.example-code.com/delphiDll/sii.asp">SII Chile</a><br>
<a href="https://www.example-code.com/delphiDll/smsapi.asp">SMSAPI</a><br>
<a href="https://www.example-code.com/delphiDll/finkok.asp">SOAP finkok.com</a><br>
<a href="https://www.example-code.com/delphiDll/sendgrid.asp">SendGrid</a><br>
<a href="https://www.example-code.com/delphiDll/shippo.asp">Shippo</a><br>
<a href="https://www.example-code.com/delphiDll/shopify.asp">Shopify</a><br>
<a href="https://www.example-code.com/delphiDll/shopware.asp">Shopware</a><br>
<a href="https://www.example-code.com/delphiDll/shopware6.asp">Shopware 6</a><br>
<a href="https://www.example-code.com/delphiDll/simpletexting.asp">SimpleTexting</a><br>
<a href="https://www.example-code.com/delphiDll/square.asp">Square</a><br>
<a href="https://www.example-code.com/delphiDll/stripe.asp">Stripe</a><br>
<a href="https://www.example-code.com/delphiDll/sugarCRM.asp">SugarCRM</a><br>
<a href="https://www.example-code.com/delphiDll/ticketBAI.asp">TicketBAI</a><br>
<a href="https://www.example-code.com/delphiDll/trello.asp">Trello</a><br>
<a href="https://www.example-code.com/delphiDll/twilio.asp">Twilio</a><br>
<a href="https://www.example-code.com/delphiDll/twitter_v2.asp">Twitter API v2</a><br>
<a href="https://www.example-code.com/delphiDll/twitter.asp">Twitter v1</a><br>
<a href="https://www.example-code.com/delphiDll/ups.asp">UPS</a><br>
<a href="https://www.example-code.com/delphiDll/UniPin.asp">UniPin</a><br>
<a href="https://www.example-code.com/delphiDll/voicebase.asp">VoiceBase</a><br>
<a href="https://www.example-code.com/delphiDll/vonage.asp">Vonage</a><br>
<a href="https://www.example-code.com/delphiDll/watrend.asp">WaTrend</a><br>
<a href="https://www.example-code.com/delphiDll/walmart.asp">Walmart</a><br>
<a href="https://www.example-code.com/delphiDll/walmart_v3.asp">Walmart v3</a><br>
<a href="https://www.example-code.com/delphiDll/wasabi.asp">Wasabi</a><br>
<a href="https://www.example-code.com/delphiDll/whatsapp.asp">WhatsApp</a><br>
<a href="https://www.example-code.com/delphiDll/wix.asp">WiX</a><br>
<a href="https://www.example-code.com/delphiDll/woocommerce.asp">WooCommerce</a><br>
<a href="https://www.example-code.com/delphiDll/wordpress.asp">WordPress</a><br>
<a href="https://www.example-code.com/delphiDll/xero.asp">Xero</a><br>
<a href="https://www.example-code.com/delphiDll/yahooMail.asp">Yahoo Mail</a><br>
<a href="https://www.example-code.com/delphiDll/yapily.asp">Yapily</a><br>
<a href="https://www.example-code.com/delphiDll/yousign.asp">Yousign</a><br>
<a href="https://www.example-code.com/delphiDll/zatca.asp">ZATCA</a><br>
<a href="https://www.example-code.com/delphiDll/zendesk.asp">Zendesk</a><br>
<a href="https://www.example-code.com/delphiDll/zoom.asp">Zoom</a><br>
<a href="https://www.example-code.com/delphiDll/aaa_misc.asp">_Miscellaneous_</a><br>
<a href="https://www.example-code.com/delphiDll/ebay.asp">eBay</a><br>
<a href="https://www.example-code.com/delphiDll/effectconnect.asp">effectconnect</a><br>
<a href="https://www.example-code.com/delphiDll/hacienda_cr.asp">hacienda.go.cr</a><br>

</b></font></p>
<p></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
          </td>
        </tr>
      </tbody></table>
      
      
 
</td>
    <td valign="top"> 
      <h1><b>(Delphi DLL) Docusign Request Impersonation Consent</b></h1>
      <p>Demonstrates how to obtain impersonation consent from a Docusign individual user.  This is one way of getting consent prior to using the JWT (JSON Web Token) grant flow to obtain access tokens.  See the Docusign documentation for <a href="https://developers.docusign.com/esign-rest-api/guides/authentication/obtaining-consent">Obtaining Consent</a> and <a href="https://developers.docusign.com/esign-rest-api/guides/authentication/oauth2-jsonwebtoken">JSON Web Token (JWT) Grant</a> for more information.
</p><p>
<b>Important: </b> This example requires that you add a line of code (or a few lines of code) to launch a web browser that navigates to the URL returned by the StartAuth method.</p><p>For more information, see <a href="https://developers.docusign.com/esign-rest-api/guides/authentication/oauth2-jsonwebtoken">https://developers.docusign.com/esign-rest-api/guides/authentication/oauth2-jsonwebtoken</a></p>
		<blockquote><table class="reference" width="500"><tbody><tr><td valign="top" colspan="3">
   <h2 id="subhdr">Chilkat for Delphi Downloads</h2>
		<p class="button"><a href="http://www.chilkatsoft.com/delphiDll.asp">Chilkat non-ActiveX DLL for Delphi</a></p>
		<p class="button"><a href="http://www.chilkatsoft.com/downloads_ActiveX.asp">Chilkat ActiveX DLL for Delphi</a></p>
		<p>* The examples here use the non-ActiveX DLL.</p>
   </td></tr>
</tbody></table>



</blockquote>
      <pre id="exCode"><span id="keyw">uses</span>
    Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
    Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, FileAccess, OAuth2, JsonObject;

...

<span id="keyw">procedure</span> TForm1.Button1Click(Sender: TObject);
<span id="keyw">var</span>
oauth2: <a target="_top" href="http://www.chilkatsoft.com/refdoc/dd_CkOAuth2Ref.html">HCkOAuth2</a>;
success: <span id="keyw">Boolean</span>;
url: <span id="keyw">PWideChar</span>;
numMsWaited: <span id="keyw">Integer</span>;
json: <a target="_top" href="http://www.chilkatsoft.com/refdoc/dd_CkJsonObjectRef.html">HCkJsonObject</a>;
fac: <a target="_top" href="http://www.chilkatsoft.com/refdoc/dd_CkFileAccessRef.html">HCkFileAccess</a>;

<span id="keyw">begin</span>
<span id="cmt">// This example requires the Chilkat API to have been previously unlocked.</span>
<span id="cmt">// See <a href="https://www.example-code.com/delphiDll/global_unlock.asp">Global Unlock Sample</a> for sample code.</span>

oauth2 := CkOAuth2_Create();

<span id="cmt">// This should be the port in the localhost Redirect URI for your app defined in the Docusign developer portal.  </span>
<span id="cmt">// The Redirect URI would look like "http://localhost:3017/" if the port number is 3017.</span>
<span id="dtyp">CkOAuth2_putListenPort</span>(oauth2,<span id="lit">3017</span>);

<span id="cmt">// For the developer sandbox environment, the authorization endpoint is https://account-d.docusign.com/oauth/auth</span>
<span id="cmt">// For the production platform, the authorization endpoint is https://account.docusign.com/oauth/auth</span>
<span id="dtyp">CkOAuth2_putAuthorizationEndpoint</span>(oauth2,<span id="lit">'https://account-d.docusign.com/oauth/auth'</span>);
<span id="dtyp">CkOAuth2_putTokenEndpoint</span>(oauth2,<span id="lit">'https://account-d.docusign.com/oauth/token'</span>);

<span id="cmt">// Replace these with actual values.</span>
<span id="cmt">// The client ID is also known as the "integration key" in Docusign.</span>
<span id="dtyp">CkOAuth2_putClientId</span>(oauth2,<span id="lit">'MY_DOCUSIGN_CLIENT_ID'</span>);
<span id="cmt">// This is your secret key for the authorization code grant.</span>
<span id="dtyp">CkOAuth2_putClientSecret</span>(oauth2,<span id="lit">'MY_DOCUSIGN_CLIENT_SECRET'</span>);

<span id="dtyp">CkOAuth2_putScope</span>(oauth2,<span id="lit">'signature impersonation'</span>);

<span id="cmt">// Begin the OAuth2 three-legged flow.  This returns a URL that should be loaded in a browser.</span>
url := <span id="dtyp">CkOAuth2__startAuth</span>(oauth2);
<span id="keyw">if</span> (<span id="dtyp">CkOAuth2_getLastMethodSuccess</span>(oauth2) &lt;&gt; <span id="lit">True</span>) <span id="keyw">then</span>
  <span id="keyw">begin</span>
    Memo1.Lines.Add(<span id="dtyp">CkOAuth2__lastErrorText</span>(oauth2));
    Exit;
  <span id="keyw">end</span>;

<span id="cmt">// At this point, your application should load the URL in a browser.</span>
<span id="cmt">// For example, </span>
<span id="cmt">// in C#: System.Diagnostics.Process.Start(url);</span>
<span id="cmt">// in Java: Desktop.getDesktop().browse(new URI(url));</span>
<span id="cmt">// in VBScript: Set wsh=WScript.CreateObject("WScript.Shell")</span>
<span id="cmt">//              wsh.Run url</span>
<span id="cmt">// in Xojo: ShowURL(url)  (see http://docs.xojo.com/index.php/ShowURL)</span>
<span id="cmt">// in Dataflex: Runprogram Background "c:\Program Files\Internet Explorer\iexplore.exe" sUrl        </span>
<span id="cmt">// The Microsoft account owner would interactively accept or deny the authorization request.</span>

<span id="cmt">// Add the code to load the url in a web browser here...</span>
<span id="cmt">// Add the code to load the url in a web browser here...</span>
<span id="cmt">// Add the code to load the url in a web browser here...</span>

<span id="cmt">// Now wait for the authorization.</span>
<span id="cmt">// We'll wait for a max of 30 seconds.</span>
numMsWaited := <span id="lit">0</span>;
<span id="keyw">while</span> (numMsWaited &lt; <span id="lit">30000</span>) and (<span id="dtyp">CkOAuth2_getAuthFlowState</span>(oauth2) &lt; <span id="lit">3</span>) <span id="keyw">do</span>
  <span id="keyw">begin</span>
    <span id="dtyp">CkOAuth2_SleepMs</span>(oauth2,<span id="lit">100</span>);
    numMsWaited := numMsWaited + <span id="lit">100</span>;
  <span id="keyw">end</span>;

<span id="cmt">// If there was no response from the browser within 30 seconds, then </span>
<span id="cmt">// the AuthFlowState will be equal to 1 or 2.</span>
<span id="cmt">// 1: Waiting for Redirect. The OAuth2 background thread is waiting to receive the redirect HTTP request from the browser.</span>
<span id="cmt">// 2: Waiting for Final Response. The OAuth2 background thread is waiting for the final access token response.</span>
<span id="cmt">// In that case, cancel the background task started in the call to StartAuth.</span>
<span id="keyw">if</span> (<span id="dtyp">CkOAuth2_getAuthFlowState</span>(oauth2) &lt; <span id="lit">3</span>) <span id="keyw">then</span>
  <span id="keyw">begin</span>
    <span id="dtyp">CkOAuth2_Cancel</span>(oauth2);
    Memo1.Lines.Add(<span id="lit">'No response from the browser!'</span>);
    Exit;
  <span id="keyw">end</span>;

<span id="cmt">// Check the AuthFlowState to see if authorization was granted, denied, or if some error occurred</span>
<span id="cmt">// The possible AuthFlowState values are:</span>
<span id="cmt">// 3: Completed with Success. The OAuth2 flow has completed, the background thread exited, and the successful JSON response is available in AccessTokenResponse property.</span>
<span id="cmt">// 4: Completed with Access Denied. The OAuth2 flow has completed, the background thread exited, and the error JSON is available in AccessTokenResponse property.</span>
<span id="cmt">// 5: Failed Prior to Completion. The OAuth2 flow failed to complete, the background thread exited, and the error information is available in the FailureInfo property.</span>
<span id="keyw">if</span> (<span id="dtyp">CkOAuth2_getAuthFlowState</span>(oauth2) = <span id="lit">5</span>) <span id="keyw">then</span>
  <span id="keyw">begin</span>
    Memo1.Lines.Add(<span id="lit">'OAuth2 failed to complete.'</span>);
    Memo1.Lines.Add(<span id="dtyp">CkOAuth2__failureInfo</span>(oauth2));
    Exit;
  <span id="keyw">end</span>;

<span id="keyw">if</span> (<span id="dtyp">CkOAuth2_getAuthFlowState</span>(oauth2) = <span id="lit">4</span>) <span id="keyw">then</span>
  <span id="keyw">begin</span>
    Memo1.Lines.Add(<span id="lit">'OAuth2 authorization was denied.'</span>);
    Memo1.Lines.Add(<span id="dtyp">CkOAuth2__accessTokenResponse</span>(oauth2));
    Exit;
  <span id="keyw">end</span>;

<span id="keyw">if</span> (<span id="dtyp">CkOAuth2_getAuthFlowState</span>(oauth2) &lt;&gt; <span id="lit">3</span>) <span id="keyw">then</span>
  <span id="keyw">begin</span>
    Memo1.Lines.Add(<span id="lit">'Unexpected AuthFlowState:'</span> + IntToStr(<span id="dtyp">CkOAuth2_getAuthFlowState</span>(oauth2)));
    Exit;
  <span id="keyw">end</span>;

Memo1.Lines.Add(<span id="lit">'OAuth2 authorization granted!'</span>);
Memo1.Lines.Add(<span id="lit">'Access Token = '</span> + <span id="dtyp">CkOAuth2__accessToken</span>(oauth2));

<span id="cmt">// Get the full JSON response:</span>
json := CkJsonObject_Create();
<span id="dtyp">CkJsonObject_Load</span>(json,<span id="dtyp">CkOAuth2__accessTokenResponse</span>(oauth2));
<span id="dtyp">CkJsonObject_putEmitCompact</span>(json,<span id="lit">False</span>);
Memo1.Lines.Add(<span id="dtyp">CkJsonObject__emit</span>(json));

<span id="cmt">// The JSON response looks like this:</span>

<span id="cmt">// Note: It doesn't seem like the access_token obtained here is actually used.</span>
<span id="cmt">// My guess is that the act of getting this access token persists the knowledge that the</span>
<span id="cmt">// DocuSign user account has granted access to the application.  The application only needs</span>
<span id="cmt">// to send a valid JWT to prove it's identity and get an access token (<a href="https://www.example-code.com/delphiDll/docusign_json_web_token_grant_jwt.asp">JSON Web Token Grant (JWT)</a>)</span>
<span id="cmt">// {</span>
<span id="cmt">//   "access_token": "eyJ0eXA....YQyig",</span>
<span id="cmt">//   "token_type": "Bearer",</span>
<span id="cmt">//   "refresh_token": "eyJ0eXA....auE3eHKg",</span>
<span id="cmt">//   "expires_in": 28800</span>
<span id="cmt">// }</span>

<span id="cmt">// Save the JSON to a file for future requests.</span>
fac := CkFileAccess_Create();
<span id="dtyp">CkFileAccess_WriteEntireTextFile</span>(fac,<span id="lit">'qa_data/tokens/docusignImpersonation.json'</span>,<span id="dtyp">CkJsonObject__emit</span>(json),<span id="lit">'utf-8'</span>,<span id="lit">False</span>);

CkOAuth2_Dispose(oauth2);
CkJsonObject_Dispose(json);
CkFileAccess_Dispose(fac);

<span id="keyw">end</span>;

</pre>
    </td>
  </tr>
</tbody></table>

<table width="100%" border="0" cellspacing="0" cellpadding="3" bgcolor="#7F2AB2">
  <tbody><tr>
    <td>&nbsp; </td>
  </tr>
</tbody></table>

<p align="center"><font size="1" color="#999999">© 
  2000-2023 Chilkat Software, Inc. All Rights Reserved.</font></p>
 


</body></html>